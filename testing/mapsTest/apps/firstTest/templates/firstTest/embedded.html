<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
    <title>Embed Map Test</title>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>

    <!-- basic map embed -->
    <!-- <script>
    function initMap() {
        var uluru = {lat: -25.363, lng: 131.044};
        var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 4,
        center: uluru
        });
        var marker = new google.maps.Marker({
        position: uluru,
        map: map
        });
    }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANNuBwaqrVDWe5_E9g0RPCeyGwTuNJlsc&callback=initMap">
    </script> -->

    <!-- map with pins -->
    <!-- <script>   
        var map;
        function initialize() {
        var myLatlng = new google.maps.LatLng(47.6062,122.3321);
        var myOptions = {
            zoom: 4,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

        google.maps.event.addListener(map, 'click', function(event) {
            placeMarker(event.latLng);
        });
        }

        function placeMarker(location) {
        var marker = new google.maps.Marker({
            position: location, 
            map: map
        });

        map.setCenter(location);
        }
        
    </script> 
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANNuBwaqrVDWe5_E9g0RPCeyGwTuNJlsc&callback=initialize">
    </script> -->


    <!-- workinprogress map code -->
    <script>
        var csrftoken = Cookies.get('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });


        // console.log('{{ locations }}')
        // var locData = JSON.parse("{{ locations }}")
        // console.log(locData)




        function sendToServer(jsonData){   
            console.log('csrf token '+csrftoken)
            $.ajax({
                url: '/jsonReceiver',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(jsonData),
                dataType: 'json',
                success: function(result) {
                    alert(result.Result);
                }
            });
            event.preventDefault();
        }

        function initMap() {
            var spaceNeedle = {lat: 47.6205, lng: -122.3493};
            var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 4,
            center: spaceNeedle,
            mapTypeId: google.maps.MapTypeId.ROADMAP
            });
            var marker = new google.maps.Marker({
            position: spaceNeedle,
            map: map
            });
            // for (var l in locData){
            //     new google.maps.Marker({
            //         position: {lat: l['lat'], lng: l['lng']},
            //         map: map 
            //     })
            // }

            google.maps.event.addListener(map, 'click', function(event) {
                placeMarker(event.latLng);
                var latitude = event.latLng.lat();
                var longitude = event.latLng.lng();
                console.log('Lat '+latitude+', Lng '+longitude)
                var data = {'lat':latitude,'lng':longitude};
                sendToServer(data);
            });


        

            function placeMarker(location) {
                var marker = new google.maps.Marker({
                    position: location, 
                    map: map
                    
                });

                map.setCenter(location);

                google.maps.event.addListener(marker, 'click', function(event){
                var latitude = event.latLng.lat();
                var longitude = event.latLng.lng();
                console.log( latitude + ', ' + longitude );

                radius = new google.maps.Circle({map: map,
                    radius: 100000,
                    center: event.latLng,
                    fillColor: '#777',
                    fillOpacity: 0.1,
                    strokeColor: '#AA0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    draggable: false,    // Dragable
                    editable: false      // Resizable
                });
            });
            }
        }

        
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyANNuBwaqrVDWe5_E9g0RPCeyGwTuNJlsc&callback=initMap">
    </script>

    <style>
        .container{ padding: 2%; }
        #map { width: 100%; height: 400px; background-color: grey; }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <!-- map goes here -->
                <div id="map"></div>
            </div>
            <div class="col-sm-2"></div>
        </div>
    </div>
    
</body>
</html>